<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/google-map/google-map-point.html">
<link rel="import" href="../../bower_components/google-map/google-map-marker.html">
<link rel="import" href="../../bower_components/google-map/google-map-poly.html">
<link rel="import" href="./poi-map-representation.html">
<dom-module id="poi-from-map">
    <template>
        <style>
        .outerdiv {
            display: inline-flex;
            align-items: flex-start;
            flex-direction: row;
            flex-wrap: wrap;
            ;
            width: 100%;
        }
        
        .innerdiv {
            display: inline-flex;
            flex-flow: initial;
            flex-direction: row;
            justify-content: flex-start;
            flex-wrap: wrap;
            align-items: flex-start;
            align-content: center;
            flex-grow: 1;
            width: 50%
        }
        
        google-map {
            width: 40%;
            height: 700px;
            display: inline-flex;
        }
        </style>
        <div class="outerdiv">
            <google-map api-key="" id="poimap" zoom="{{mapzoom}}" latitude="{{lat}}" longitude="{{long}}" click-events>
                <template is="dom-repeat" items={{markers}} as="marker">
                    <google-map-marker click-events title="{{marker.title}}" icon={{marker.icon}} on-google-map-marker-click="{{markerClicked}}" latitude="{{marker.latitude}}" longitude="{{marker.longitude}}"></google-map-marker>
                </template>
            </google-map>
            <div class=innerdiv>
                <template is="dom-repeat" items={{markers}} as="marker">
                    <poi-map-representation map-zoom="{{mapZoom}}" map-latitude="{{lat}}" map-longitude="{{long}}" latitude="{{marker.latitude}}" longitude="{{marker.longitude}}" icon={{marker.icon}} info={{marker.info}} title="{{marker.title}}"></poi-map-representation>
                </template>
            </div>
        </div>
    </template>
    <script>
    (function() {
        'use strict';

        Polymer({
            is: 'poi-from-map',
            ready: function() {
                this.set('markers', [])
                this.$.poimap.addEventListener("google-map-click", this.addMarker.bind(this))
                this.addEventListener("remove-marker", this.removeMarker.bind(this))

            },

            removeMarker: function(event) {
                var i=this.findIndex(event.detail);
                this.splice('markers',i,1);
            },

            findIndex:function(coord){
                for(var i=0;i<this.markers.length;i++){
                    if(this.markers[i].latitude==coord.latitude){
                        if(this.markers[i].longitude==coord.longitude){
                            return i
                        }
                    }
                }
                return -1
            },
            addMarker: function(event) {
                var lat = event.detail.latLng.lat();
                var long = event.detail.latLng.lng();
                this.push('markers', {
                    latitude: lat,
                    longitude: long
                })
            },


            properties: {
                lat: {
                    type: Number
                },
                long: {
                    type: Number
                }

            }
        })
    })();
    </script>
</dom-module>
