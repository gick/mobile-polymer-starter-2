<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="unit-card">
  <style>

    paper-card {
    }


    paper-card {
      max-width: 400px;
      margin : 0 auto;
      margin-top:90px;
      margin-bottom:90px;
      display:block;
      --paper-card-header-color: #ff0000;
      --paper-card-header-image:{width:10px;height:10px}
    }

    paper-card{
    --paper-card-header-image{
      width:10px;
      height:10px;
      opacity:0;
    }}










    .disabled{
      opacity:0.2;
      pointer-events: none;
      cursor: default;
    }

    .done{
      opacity:0.7;
      background-color: greenyellow;
      pointer-events: none;
      cursor: default;

    }

  </style>
  <template>
    <iron-ajax auto url="example.json" handle-as="json" last-response="{{items}}"></iron-ajax>

    <template    id="mainRepeat" is="dom-repeat" items="{{items}}" as="item">
      <fullscreen-api  class="fsapi"></fullscreen-api>

      <button type="button" on-click="goFullscreen" hidden$="[[!fullscreenAvailable]]">Display this page in full screen mode</button>

      <paper-card style="--paper-card-header-image:{width:10px,height:10px}"class$="[[item.class ]]"   heading="[[item.activityName]]" image="./images/tree2.png" >
      <div class="card-content">

      </div>
      <div class="card-actions">
        <template is="dom-if" if="{{item.started}}">
          <template is="dom-if" if="[[item.indice.isBasic]]">
          <basic-indice indice="[[item.indice]]"></basic-indice>
            </template>
          <template is="dom-if" if="[[item.indice.isGmap]]">
            <gmap-activity id="map"></gmap-activity>
          </template>

        </template>
        <mcq-activity anal="{{index}}"  id="mcq"></mcq-activity>
        <template is="dom-if" if="{{item.completed}}">
          You learn this today
        </template>
        <paper-button id="Start" on-click="start">OK</paper-button>
        <paper-button on-click="nextActivity" id="cancel" >Dismiss</paper-button>
      </div>
    </paper-card>
  </template>
</template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'unit-card',
        showMCQ:function(item){
          var dialog = Polymer.dom(this.root).querySelectorAll("mcq-activity");


            dialog[item.model.__data__.index].open(item.model.__data__.index);



        },
        ready:function(){
          this.addEventListener('eventFromChild', this.myAction);
          this.addEventListener('eventFromIndiceChild', this.indiceCompleted);

        },
        indiceCompleted:function(e){
          var dialog = Polymer.dom(this.root).querySelector("mcq-activity");
          dialog.open();
        },
        goFullscreen:function(e) {
         var index =e.model.index+1;
          var fsapi = Polymer.dom(this.root).querySelector(".fsapi");
          fsapi.setAttribute('target','paper-card:nth-of-type('+index+')');
        fsapi.toggleFullscreen();
      }

        ,

        computeClass:function(item){
          console.log(item)
          if(item.current) return "";
          else return "disabled"
        },

        myAction:function(e,f){
          console.log(e.detail)
          console.log(f)
          alert('mcqcomplete')
        },
        start:function(e){
        var model= e.model;
        //  this.items[e.model.index].started=!this.items[e.model.index].started;
          model.set('item.started',!this.items[e.model.index].started);
          console.log(e.model);


        },

        nextActivity:function(e){
          var model= e.model
          var index= e.model.index+1;
          console.log(index)
          var str='items.'+index+'.class'
          this.set(str,'current');
          model.set('item.class',"disabled");
          console.log(this.items)
        }
        ,

        properties: {
          items:{type : Array, notify:true}
        }
      });
    })();
  </script>
</dom-module>
